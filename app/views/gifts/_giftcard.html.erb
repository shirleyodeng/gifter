<div id="popup">
  <a><%= cl_image_tag gift.photo, width: 190, height: 190, crop: :fill, class: "gift-photo" %>
    <span>
      <div class="pop-up-box">
        <div class="pop-up-info">
          <% if gift.participations.empty? %>
            <p class="pop-up-info">Be the first to contribute to <strong class="larger-text"><%= gift.capitalized_name %></strong>!</p>
            <div class="small-jar"><%= image_tag "jamjar.jpg" %></div>
          <% elsif gift.participations.count == 1 %>
            <p class="pop-up-info"><%= gift.participations.first.user.first_name.capitalize %> has contributed to <strong class="larger-text"><%= gift.name %></strong>!</p>
          <% else %>
            <p class="pop-up-info"><%= gift.participations.count %> people have contributed to <strong class="larger-text"><%= gift.capitalized_name %></strong></p>
            <div class="small-jar padding-bottom"><%= image_tag "jamjar.jpg" %></div>
            <% if gift.amount_left.zero? %>
              <p class="pop-up-info">This gift has been fulfilled!</p>
            <% else %>
              <p class="pop-up-info">Amount needed: £<%= gift.amount_left %></p>
            <% end %>
          <% end %>
        </div>
      </div>
    </span>
  </a>
</div>
<div class="gift-info">
  <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal<%= gift.id %>">
    <div class="gift-modal-name">
      <%= gift.capitalized_name %>
    </div>
  </button>
  <div id="myModal<%= gift.id %>" class="modal" role="dialog">
    <div class="modal-dialog modal-background-color">
      <div class="modal-content">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
        <div class="modal-body">
          <div>
            <div class="modal-title">
              <p>You have selected</p>
              <h4><%= gift.capitalized_name %></h4>
            </div>
            <div class="modal-info">
              <%= cl_image_tag (gift.photo), width: 200, height: 200, crop: :fill, class: "gift-photo" %>
              <p><%= gift.description %></p>
            </div>
          </div>
          <div class="modal-pay">
           <div class="jar"><%= image_tag "jamjar.jpg" %></div>
            <div class="contributions">
              <% if gift.participations.where(state: 'paid').empty? %>
                <p>Be the first to contribute!</p>
                <div class="modal-padding"><strong>£<%= gift.price %></strong></div>
                <%= simple_form_for @participation do |f| %>
                  <%= f.hidden_field :gift_id, value: gift.id %>
                  <%= f.hidden_field :invite_token, value: token %>
                  <%= f.input :amount %>
                  <%= f.submit 'Contribute', class: 'btn-red' %>
                <% end %>
              <% else %>
                <div class="contributors">
                  <div class="contributors-container">
                    <% gift.participations.where(state: 'paid').each do |participation| %>
                      <% if participation.user.photo? %>
                        <%= cl_image_tag participation.user.photo, class: "contributor-avatar" %>
                      <% else %>
                        <%= cl_image_tag 'default-profile-image', class: "contributor-avatar" %>
                      <% end %>
                    <% end %>
                  </div>
                  <%= render 'contributors', gift: gift %>
                </div>
                <div class="modal-padding">
                  <strong>£<%= gift.price %></strong></br>
                  <strong>Remaining: £<%= gift.amount_left %></strong>
                </div>
                <% if gift.amount_left.zero? %>
                  <p>This gift has been fulfilled!</p>
                <% else %>
                  <%= simple_form_for @participation do |f| %>
                    <%= f.hidden_field :gift_id, value: gift.id %>
                    <%= f.input :amount %>
                    <%= f.submit 'Contribute', class: 'btn-red' %>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
